/*
 * Copyright (c) teris.io & Oleg Sklyar, 2017. All rights reserved
 */

import java.nio.file.Paths

ext {
  findbugsModule = "com.google.code.findbugs:annotations:3.0.1"
	jacksonDatabindModule = "com.fasterxml.jackson.core:jackson-databind:2.9.2"
	vertxWebModule = "io.vertx:vertx-web:3.5.0"

	junitModule = "junit:junit:4.12"
	mockitoModule = "org.mockito:mockito-core:2.12.0"
}

allprojects {
	version = "0.1.0-SNAPSHOT"
	group = "io.teris.rpc"

	plugins.apply(JacocoPlugin)

	repositories.jcenter()
}

subprojects {
  plugins.apply(JavaPlugin)

	test.jacoco {
		append = false
		destinationFile = Paths.get(rootProject.buildDir.absolutePath, "jacoco", project.name + ".exec").toFile()
	}

	jacocoTestReport.reports {
		xml.enabled = false
		html.enabled = false
		csv.enabled = false
	}
}

task("clean", type: Delete) {
	delete(buildDir)
}

task("coverage", type: JacocoReport) {
	dependsOn(subprojects*.test)

	executionData(fileTree(Paths.get(rootProject.buildDir.absolutePath, "jacoco").toFile()).include("*.exec"))

	setSourceDirectories(files(subprojects*.sourceSets.main.java.srcDirs))
	setClassDirectories(files(subprojects*.sourceSets.main.output))

	reports {
		xml.enabled = true
		xml.setDestination(Paths.get(rootProject.buildDir.absolutePath, "reports", "jacoco", "report.xml").toFile())
		html.enabled = false
		csv.enabled = false
	}
}
